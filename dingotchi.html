<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dino-Gotchi Text Art</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');

        :root {
            --case-color: #e0e0e0; /* Color carcasa clásica */
            --screen-bg: #9ea788;  /* Verde LCD */
            --pixel-color: #222;
        }

        body {
            background-color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: 'VT323', monospace;
            overflow: hidden;
            user-select: none;
        }

        /* La carcasa del huevo */
        .device {
            width: 320px;
            height: 420px; /* Altura aumentada para acomodar el desplazamiento */
            background-color: var(--case-color);
            border-radius: 50% 50% 45% 45% / 60% 60% 40% 40%;
            position: relative;
            box-shadow: -5px 5px 0px #00000040, inset 5px -5px 10px #ffffff80;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 90px; /* Mayor padding superior para bajar la pantalla */
            border: 4px solid #aaa;
            box-sizing: border-box; /* Importante para padding */
            transition: all 0.3s ease;
        }

        /* Grietas decorativas */
        .crack {
            position: absolute;
            top: 30px;
            left: 50%;
            width: 40px;
            height: 20px;
            border-bottom: 2px solid #aaa;
            transform: translateX(-50%) rotate(-5deg);
        }

        /* La Pantalla LCD */
        .screen-container {
            width: 200px;
            height: 140px;
            background-color: var(--screen-bg);
            border: 4px solid #666;
            border-radius: 10px;
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.3);
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* El área de texto ASCII */
        #display {
            font-family: 'Courier New', monospace; /* Monospace estricto para ASCII */
            font-weight: bold;
            font-size: 14px;
            line-height: 14px;
            white-space: pre;
            color: var(--pixel-color);
            text-align: center;
            z-index: 2;
        }

        /* Iconos de menú (arriba y abajo) */
        .menu-icons {
            position: absolute;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 2px 5px;
            box-sizing: border-box;
            font-size: 12px;
            color: rgba(0,0,0,0.2);
            font-weight: bold;
        }
        
        .menu-top { top: 2px; }
        .menu-bottom { bottom: 2px; }

        .icon { padding: 0 2px; }
        .icon.active { 
            color: #000; 
            background: rgba(0,0,0,0.1);
            border-radius: 2px;
        }
        .icon.selected {
            color: #000;
            outline: 1px solid #000;
        }

        /* Contenedor de controles */
        .controls-container {
            margin-top: auto; /* Empuja hacia abajo */
            margin-bottom: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Botones físicos */
        .buttons {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .btn {
            width: 45px;
            height: 45px;
            background-color: #ffcc00; /* Botones amarillos clásicos */
            border-radius: 50%;
            border: none;
            box-shadow: 2px 2px 0px #b38f00, inset 2px 2px 5px #ffdb4d;
            cursor: pointer;
            font-family: 'VT323', monospace;
            font-size: 14px;
            color: #b38f00;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 0.1s;
        }

        .btn:active {
            transform: translate(2px, 2px);
            box-shadow: inset 2px 2px 5px #b38f00;
        }

        .label-group {
            width: 200px;
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #666;
            font-weight: bold;
            margin-bottom: 5px;
        }

        /* Overlay para efectos (noche) */
        .overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            z-index: 10;
            pointer-events: none;
        }
        .overlay.on { display: block; }

        /* --- ESTILOS REACTIVOS (MOBILE) --- */
        @media (max-width: 480px) {
            .device {
                width: 90vw;
                height: 115vw; /* Mantener proporción */
                max-height: 80vh;
                padding-top: 25%; /* Proporcional al ancho */
                border-width: 3px;
            }

            .crack {
                top: 5%;
                width: 15%;
                height: 5%;
            }

            .screen-container {
                width: 70%;
                height: 40%;
                border-width: 3px;
            }

            #display {
                font-size: 3.5vw; /* Tamaño de fuente relativo */
                line-height: 3.5vw;
            }

            .menu-icons {
                font-size: 3vw;
                padding: 1% 2%;
            }

            .controls-container {
                margin-bottom: 10%;
            }

            .label-group {
                width: 70%;
                font-size: 4vw;
            }

            .buttons {
                gap: 5vw;
                margin-top: 2vw;
            }

            .btn {
                width: 12vw;
                height: 12vw;
                font-size: 4vw;
                box-shadow: 1px 1px 0px #b38f00, inset 1px 1px 3px #ffdb4d;
            }
            
            .btn:active {
                transform: translate(1px, 1px);
                box-shadow: inset 1px 1px 3px #b38f00;
            }
        }

    </style>
</head>
<body>

<!-- Elementos de Audio -->
<audio id="bg-music-1" loop preload="auto">
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    Tu navegador no soporta audio.
</audio>
<audio id="bg-music-2" loop preload="auto">
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" type="audio/mpeg">
    Tu navegador no soporta audio.
</audio>

<div class="device">
    <div class="crack"></div>
    
    <div class="screen-container">
        <!-- Iconos Superiores -->
        <div class="menu-icons menu-top">
            <span id="icon-food" class="icon">COMIDA</span>
            <span id="icon-light" class="icon">LUZ</span>
            <span id="icon-game" class="icon">JUEGO</span>
            <span id="icon-meds" class="icon">CURAR</span>
        </div>

        <!-- Área Principal de Dibujo -->
        <div id="display">
            CARGANDO...
        </div>
        <div id="overlay" class="overlay"></div>

        <!-- Iconos Inferiores -->
        <div class="menu-icons menu-bottom">
            <span id="icon-bath" class="icon">BAÑO</span>
            <span id="icon-stats" class="icon">ESTADO</span>
            <span id="icon-scold" class="icon">REGAÑAR</span>
            <span id="icon-alert" class="icon">⚠</span>
        </div>
    </div>

    <div class="controls-container">
        <div class="label-group">
            <span>A</span>
            <span>B</span>
            <span>C</span>
        </div>

        <div class="buttons">
            <button class="btn" id="btn-a" onclick="handleInput('A')"></button>
            <button class="btn" id="btn-b" onclick="handleInput('B')"></button>
            <button class="btn" id="btn-c" onclick="handleInput('C')"></button>
        </div>
    </div>
</div>

<script>
    /**
     * MOTOR DE ASCII Y LÓGICA
     */

    // --- ARTE ASCII (2 Frames por estado) ---
    const SPRITES = {
        egg: [
            "   __   \n  /  \\  \n |    | \n |____| ",
            "   __   \n  /  \\  \n | .. | \n |____| " // Pulsando
        ],
        baby: {
            idle: [
                "  __ \n /  \\\n( o )\n V V ",
                "  __ \n /  \\\n( - )\n V V "
            ],
            happy: [
                " \\__/ \n (^o^)\n /  \\ \n d  b ",
                "      \n \\__/ \n (^o^)\n /  \\ " // Saltando
            ],
            sad: [
                "      \n  __  \n ( T_)\n  / \\ ",
                "      \n  __  \n ( ._)\n  / \\ "
            ]
        },
        adult: {
            idle: [
                "   ,  \n _/|__\n( o  )\n L--L ",
                "   ,  \n _/|__\n( -  )\n /  \\ "
            ],
            happy: [
                "   !  \n _/|__\n(^ 0 ^)\n \\  / ",
                "      \n _/|__\n(> v <)\n L  L "
            ],
            sad: [
                "      \n _/|__\n( ; _)\n L  L ",
                "      \n _/|__\n( . _)\n L  L "
            ],
            eat: [
                "      \n _/|__\n( O  ) O\n L--L ",
                "      \n _/|__\n( -  )\n L--L "
            ]
        },
        poop: "  @  \n ~~~ ",
        skull: " [X] \n / \\ ",
        grave: "  _|_  \nR.I.P.\n[____]",
        game: {
            left: "<-- ?",
            right: "? -->",
            win: "WIN!",
            lose: "X_X"
        }
    };

    // --- ESTADO DEL JUEGO ---
    const STATE = {
        HATCHING: 0,
        NORMAL: 1,
        MENU: 2,
        EATING: 3,
        GAME: 4,
        SLEEP: 5,
        SICK: 6,
        DEAD: 7
    };

    let gameState = STATE.HATCHING;
    let frame = 0; // 0 o 1
    let frameCounter = 0;
    
    // Variables de la Mascota
    let pet = {
        name: "Dino",
        age: 0,         // Días
        weight: 5,      // Oz
        hunger: 4,      // Max 4
        happiness: 4,   // Max 4
        discipline: 0,  // Max 100
        poop: 0,        // Cantidad de caca en pantalla
        sick: false,
        sleeping: false,
        stage: 'egg',   // egg, baby, adult
        alive: true
    };

    // Variables de Sistema
    let menuIndex = 0; // 0-6 para los iconos
    let menuActive = false;
    let messageTimer = null; // Para mostrar texto temporal
    let actionTimer = null; // Para animaciones de comer, etc.
    let gameGuess = null;   // 0: Izq, 1: Der
    let gameResult = null;
    
    const MENUS = ['food', 'light', 'game', 'meds', 'bath', 'stats', 'scold'];
    const UI_ICONS = {
        food: document.getElementById('icon-food'),
        light: document.getElementById('icon-light'),
        game: document.getElementById('icon-game'),
        meds: document.getElementById('icon-meds'),
        bath: document.getElementById('icon-bath'),
        stats: document.getElementById('icon-stats'),
        scold: document.getElementById('icon-scold'),
        alert: document.getElementById('icon-alert')
    };
    const DISPLAY = document.getElementById('display');
    const OVERLAY = document.getElementById('overlay');

    // --- LÓGICA DE AUDIO ---
    const musicTracks = ['bg-music-1', 'bg-music-2'];
    let currentTrackIndex = 0;
    let musicStarted = false;
    let musicInterval = null;

    function startMusic() {
        if (musicStarted) return;
        musicStarted = true;
        
        playTrack(currentTrackIndex);

        // Cambiar pista cada 2 minutos (120000 ms)
        musicInterval = setInterval(() => {
            changeMusic();
        }, 120000); 
    }

    function playTrack(index) {
        const trackId = musicTracks[index];
        const audio = document.getElementById(trackId);
        if (audio) {
            audio.volume = 0.3; // Volumen bajo para fondo
            audio.play().catch(e => console.log("Error reproduciendo audio:", e));
        }
    }

    function stopTrack(index) {
        const trackId = musicTracks[index];
        const audio = document.getElementById(trackId);
        if (audio) {
            audio.pause();
            audio.currentTime = 0;
        }
    }

    function changeMusic() {
        stopTrack(currentTrackIndex);
        currentTrackIndex = (currentTrackIndex + 1) % musicTracks.length;
        playTrack(currentTrackIndex);
    }

    // --- CORE LOOP ---
    
    // Reloj del juego (Lógica lenta: Hambre, Edad)
    setInterval(() => {
        if (!pet.alive || gameState === STATE.HATCHING) return;

        // Si duerme, no le da hambre pero recupera energía
        if (pet.sleeping) {
            // Lógica de sueño
            return; 
        }

        // Reducir stats aleatoriamente
        if (Math.random() > 0.7) pet.hunger = Math.max(0, pet.hunger - 1);
        if (Math.random() > 0.8) pet.happiness = Math.max(0, pet.happiness - 1);

        // Generar caca
        if (pet.hunger > 0 && Math.random() > 0.9 && pet.poop < 4) {
            pet.poop++;
        }

        // Enfermar
        if ((pet.poop > 2 || pet.hunger === 0) && Math.random() > 0.8) {
            pet.sick = true;
        }

        // Muerte
        if (pet.sick && pet.hunger === 0 && pet.happiness === 0) {
            die();
        }

        // Crecer
        pet.weight += 1;
        if (frameCounter % 100 === 0) { // Ciclo largo simulado
            pet.age++;
            if (pet.stage === 'baby' && pet.age > 2) {
                evolve('adult');
            }
        }
        
        checkAlert();

    }, 3000); // "Tick" del juego cada 3 segundos

    // Reloj de Renderizado (Rápido: Animación)
    setInterval(() => {
        frameCounter++;
        if (frameCounter % 10 === 0) { // Cambiar frame cada ~500ms
            frame = frame === 0 ? 1 : 0;
            render();
        }
    }, 50);

    // --- RENDERIZADO ---

    function render() {
        // Actualizar iconos UI
        MENUS.forEach((m, i) => {
            UI_ICONS[m].classList.remove('selected');
            if (menuActive && i === menuIndex) {
                UI_ICONS[m].classList.add('selected');
            }
        });

        // Pantalla muerta
        if (!pet.alive) {
            DISPLAY.innerHTML = SPRITES.grave + "\n\nEDAD: " + pet.age;
            return;
        }

        // Pantalla eclosión
        if (gameState === STATE.HATCHING) {
            DISPLAY.innerText = SPRITES.egg[frame];
            return;
        }

        // Pantalla comiendo
        if (gameState === STATE.EATING) {
            const sprite = pet.stage === 'adult' ? SPRITES.adult.eat : SPRITES.baby.happy;
            DISPLAY.innerText = sprite[frame] + (frame===0 ? " MMM" : "");
            return;
        }

        // Pantalla durmiendo
        if (pet.sleeping) {
            DISPLAY.innerText = (pet.stage === 'adult' ? SPRITES.adult.idle[0] : SPRITES.baby.idle[0]) + "\n" + (frame === 0 ? "Zzz" : " Zzz");
            return;
        }

        // Pantalla juego
        if (gameState === STATE.GAME) {
            if (gameResult !== null) {
                DISPLAY.innerText = gameResult ? SPRITES.game.win : SPRITES.game.lose;
            } else {
                DISPLAY.innerText = frame === 0 ? SPRITES.game.left : SPRITES.game.right;
            }
            return;
        }

        // Mostrar texto temporal (ej: stats)
        if (gameState === STATE.MENU && !menuActive) {
            // Estamos viendo stats u otra pantalla de texto controlada por el estado
            return; 
        }

        // RENDERIZADO NORMAL (IDLE)
        let art = "";
        
        // Determinar sprite base
        let baseSprite = [];
        if (pet.sick) {
            baseSprite = pet.stage === 'adult' ? SPRITES.adult.sad : SPRITES.baby.sad;
        } else if (pet.happiness < 2) {
             baseSprite = pet.stage === 'adult' ? SPRITES.adult.sad : SPRITES.baby.sad;
        } else if (pet.happiness === 4) {
             baseSprite = pet.stage === 'adult' ? SPRITES.adult.happy : SPRITES.baby.happy;
        } else {
             baseSprite = pet.stage === 'adult' ? SPRITES.adult.idle : SPRITES.baby.idle;
        }

        art = baseSprite[frame];

        // Añadir caca si existe
        if (pet.poop > 0) {
            // Hack simple para poner caca al lado: reemplazar espacios
            let lines = art.split('\n');
            if (pet.poop >= 1) lines[3] += " @";
            if (pet.poop >= 3) lines[2] += " @";
            art = lines.join('\n');
        }

        if (pet.sick) {
            art += "\n(ENFERMO)";
        }

        DISPLAY.innerText = art;
    }

    // --- CONTROLES (INPUT) ---

    function handleInput(btn) {
        // Iniciar música en la primera interacción
        startMusic();

        if (!pet.alive) {
            if (btn === 'B') location.reload(); // Reiniciar
            return;
        }

        // Si está en una animación bloqueante (comiendo, resultado juego), ignorar
        if (actionTimer) return;

        // Cancelar (C)
        if (btn === 'C') {
            cancelAction();
            return;
        }

        // Seleccionar (A)
        if (btn === 'A') {
            if (gameState === STATE.GAME) {
                playGameGuess(0); // Izquierda
            } else if (!menuActive) {
                menuActive = true;
                menuIndex = 0;
            } else {
                menuIndex = (menuIndex + 1) % MENUS.length;
            }
            render();
            return;
        }

        // Confirmar (B)
        if (btn === 'B') {
            if (gameState === STATE.HATCHING) {
                // Configurar reloj si fuera real, aquí saltamos
                return; 
            }
            
            if (gameState === STATE.GAME) {
                playGameGuess(1); // Derecha
                return;
            }

            if (menuActive) {
                executeMenuAction(MENUS[menuIndex]);
            } else {
                // Botón B sin menú muestra la hora (no implementado en ASCII simple) o hace nada
            }
        }
    }

    function executeMenuAction(action) {
        if (pet.sleeping && action !== 'light') {
            showText("ZZZ...");
            return;
        }

        switch(action) {
            case 'food':
                if (pet.hunger < 4) {
                    gameState = STATE.EATING;
                    pet.hunger++;
                    pet.weight += 2;
                    menuActive = false;
                    actionTimer = setTimeout(() => {
                        gameState = STATE.NORMAL;
                        actionTimer = null;
                        // Probabilidad de caca después de comer
                        if(Math.random() > 0.5) pet.poop++; 
                    }, 3000);
                } else {
                    showText("LLENO");
                }
                break;

            case 'light':
                pet.sleeping = !pet.sleeping;
                OVERLAY.classList.toggle('on', pet.sleeping);
                menuActive = false;
                break;

            case 'game':
                if (pet.sick) {
                    showText("NO...");
                } else {
                    startGame();
                }
                break;

            case 'meds':
                if (pet.sick) {
                    showText("CURANDO");
                    actionTimer = setTimeout(() => {
                        pet.sick = false;
                        pet.happiness -= 1; // Odiaba la medicina
                        actionTimer = null;
                        cancelAction();
                    }, 2000);
                } else {
                    showText("SANO");
                }
                break;

            case 'bath':
                if (pet.poop > 0) {
                    showText("LIMPIO!");
                    actionTimer = setTimeout(() => {
                        pet.poop = 0;
                        actionTimer = null;
                        cancelAction();
                    }, 2000);
                } else {
                    showText("LIMPIO");
                }
                break;

            case 'stats':
                showStats();
                break;

            case 'scold':
                pet.discipline += 10;
                pet.happiness -= 1;
                showText("GRRR!");
                break;
        }
    }

    // --- FUNCIONES AUXILIARES ---

    function showText(txt) {
        menuActive = false;
        // Guardamos el estado anterior para saber si volver a NORMAL
        const oldState = gameState;
        gameState = STATE.MENU; // Usamos estado MENU para bloquear render normal
        DISPLAY.innerText = "\n" + txt;
        
        // Limpiar timer anterior si existe
        if (messageTimer) clearTimeout(messageTimer);
        
        messageTimer = setTimeout(() => {
            gameState = STATE.NORMAL;
            messageTimer = null;
        }, 2000);
    }

    function showStats() {
        menuActive = false;
        gameState = STATE.MENU;
        
        let heart = "♥";
        let burger = "o";
        
        let hungerStr = burger.repeat(pet.hunger) + ".".repeat(4 - pet.hunger);
        let happyStr = heart.repeat(pet.happiness) + ".".repeat(4 - pet.happiness);

        let statsText = 
            `EDAD: ${pet.age}A\n` +
            `PESO: ${pet.weight}oz\n` +
            `HAMB: ${hungerStr}\n` +
            `FELI: ${happyStr}`;
            
        DISPLAY.innerText = statsText;

        if (messageTimer) clearTimeout(messageTimer);
        messageTimer = setTimeout(() => {
            gameState = STATE.NORMAL;
            messageTimer = null;
        }, 4000);
    }

    function cancelAction() {
        menuActive = false;
        gameState = STATE.NORMAL;
        if (messageTimer) clearTimeout(messageTimer);
        if (actionTimer) {
            clearTimeout(actionTimer);
            actionTimer = null;
        }
    }

    function checkAlert() {
        let alert = false;
        if (pet.hunger <= 0 || pet.happiness <= 0 || pet.sick || pet.poop >= 3) {
            alert = true;
        }
        
        if (alert) {
            UI_ICONS['alert'].classList.add('selected'); // Parpadeará por el render loop a veces, pero ok
        } else {
            UI_ICONS['alert'].classList.remove('selected');
        }
    }

    function die() {
        pet.alive = false;
        gameState = STATE.DEAD;
        OVERLAY.classList.remove('on'); // Quitar oscuridad si murió durmiendo
    }

    function evolve(newStage) {
        showText("EVOLUCION");
        setTimeout(() => {
            pet.stage = newStage;
            cancelAction(); // Volver a normal
        }, 2000);
    }

    // --- LÓGICA MINIJUEGO ---
    
    function startGame() {
        menuActive = false;
        gameState = STATE.GAME;
        gameResult = null;
    }

    function playGameGuess(guess) {
        // 0 = Izq (A), 1 = Der (B)
        // La lógica real: adivinar a dónde mirará.
        let direction = Math.random() > 0.5 ? 1 : 0;
        
        if (guess === direction) {
            gameResult = true;
            pet.happiness = Math.min(4, pet.happiness + 1);
            pet.weight -= 1; // Jugar baja peso
        } else {
            gameResult = false;
        }
        
        render(); // Mostrar resultado
        
        actionTimer = setTimeout(() => {
            gameState = STATE.NORMAL;
            gameResult = null;
            actionTimer = null;
        }, 2000);
    }

    // --- INICIO ---
    setTimeout(() => {
        gameState = STATE.NORMAL;
        pet.stage = 'baby';
    }, 4000); // 4 seg para nacer

</script>

</body>
</html>
